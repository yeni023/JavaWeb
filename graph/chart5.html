<!-- core, task 버튼 생성은 했지만 데이터 파싱 부분으로 인해 그래프가 정상적으로 나오지 않음 -->

<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Chart.js Example</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>
<body>
    <h1>Task Performance</h1>
    <div>
        <button class="task-button" data-task="1">TASK 1</button>
        <button class="task-button" data-task="2">TASK 2</button>
        <button class="task-button" data-task="3">TASK 3</button>
        <button class="task-button" data-task="4">TASK 4</button>
        <button class="task-button" data-task="5">TASK 5</button>
    
        <button class="core-button" data-task="6">CORE 1</button>
        <button class="core-button" data-task="7">CORE 2</button>
        <button class="core-button" data-task="8">CORE 3</button>
        <button class="core-button" data-task="9">CORE 4</button>
        <button class="core-button" data-task="10">CORE 5</button>
      </div>
    <div>
        <canvas id="myChart"></canvas>
    </div>

    <script>
    
        // 데이터 파싱
        const data = `	task1	task2	task3	task4	task5
        core1	886	749	849	909	352	
        core2	959	849	788	1053	324	
        core3	942	867	930	1064	365	
        core4	820	817	816	929	336	
        core5	803	786	929	958	329`.split("\n");
        
        const cores = [];
        const tasks = [];
        const values = [];
    
        for (let i = 0; i < data.length; i++) {
            const row = data[i].split("\t");
            cores.push(row[0]);
            for (let j = 1; j < row.length; j++) {
                if (i == 0) {
                    tasks.push(row[j]);
                }
                if (!values[j - 1]) { // 해당 인덱스의 값이 없으면
                    values[j - 1] = []; // 빈 배열로 초기화
                }
                values[j - 1].push(Number(row[j]));
            }
        }
        // 최소, 최대, 평균 값 계산
        const taskMinValues = [];
        const taskMaxValues = [];
        const taskAvgValues = [];
        const coreMinValues = [];
        const coreMaxValues = [];
        const coreAvgValues = [];
        
        for (let i = 0; i < tasks.length; i++) {
            let nums = values[i].filter((val) => !isNaN(val));
            taskMinValues.push(Math.min(...nums));
            taskMaxValues.push(Math.max(...nums));
            taskAvgValues.push(nums.reduce((acc, cur) => acc + cur) / nums.length);
        }
        // console.log(values);
        for (let i = 0; i < cores.length; i++) {
            let nums = values[i].filter((val) => !isNaN(val));
            coreMinValues.push(Math.min(...nums));
            coreMaxValues.push(Math.max(...nums));
            coreAvgValues.push(nums.reduce((acc, cur) => acc + cur) / nums.length);
        }
        
        // 차트 생성
        const core_ctx = document.getElementById('myChart').getContext('2d');
        const core_myChart = new Chart(core_ctx, {
            type: 'line',
            data: {
                labels: cores,
                datasets: [{
                    label: 'Minimum',
                    data: coreMinValues,
                    fill: false,
                    borderColor: 'rgb(255, 99, 132)',
                    lineTension: 0.1
                }, {
                    label: 'Maximum',
                    data: coreMaxValues,
                    fill: false,
                    borderColor: 'rgb(54, 162, 235)',
                    lineTension: 0.1
                }, {
                    label: 'Average',
                    data: coreAvgValues,
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    lineTension: 0.1
                }]
            },
            options: {}
        });
        
        // 데이터 업데이트 함수
        function updateData(type) {
            let newValues;
            switch (type) {
                case 'min':
                    newValues = minValues;
                    break;
                case 'max':
                    newValues = maxValues;
                    break;
                case 'avg':
                    newValues = avgValues;
                    break;
            }
            core_myChart.data.datasets.forEach((dataset, i) => {
                dataset.data = newValues;
            });
            core_myChart.update();
        }
    </script>
</body>
</html>